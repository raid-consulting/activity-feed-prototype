<!doctype html>
<html lang="en" data-theme="dark">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mail Integration Admin</title>
<style>
  :root { --radius:14px; --gap:12px; --focus:#6ea4e8; }
  :root, html[data-theme="dark"] {
    --bg:#141b26; --panel:#1a2330; --ink:#f4f7fb; --text:#d7dee7; --muted:#a5b3c5;
    --line:#364353; --card:#1d2735; --card-hover:#243041; --banner:#1b2534;
    --detail:#202b3b; --btn:#232f3f; --btn-hover:#2a3749; --accent-muted:#93a5bb;
    --red:#ea7c76; --green:#5ec49d; --blue:#78aeea; --amber:#e7ad6a; --crimson:#ed8a7d;
    --shadow:0 6px 24px rgba(6,11,20,.32);
  }
  html[data-theme="light"] {
    --bg:#f2f4f7; --panel:#ffffff; --ink:#1e2936; --text:#2e3a4c; --muted:#647184;
    --line:#d0d7e2; --card:#ffffff; --card-hover:#f5f7fa; --banner:#f1f3f7;
    --detail:#f7f9fc; --btn:#eceff5; --btn-hover:#e1e5ed; --accent-muted:#7b889b;
    --red:#c6615b; --green:#3c8f6b; --blue:#3a7bd5; --amber:#c38b44; --crimson:#c46f63;
    --shadow:0 4px 18px rgba(15,23,42,.08); --focus:#3a7bd5;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);
    font: clamp(15px,1.6vw,17px)/1.5 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;
    display:grid;place-items:center;padding:clamp(16px,3vw,28px);transition:background .2s,color .2s}
  .frame{width:min(1100px,98vw);background:var(--panel);border:2px solid var(--line);border-radius:18px;padding:clamp(12px,2.2vw,18px);box-shadow:var(--shadow);
    display:grid;gap:clamp(12px,2.2vw,18px)}
  .inner{display:grid;gap:16px;background:var(--panel);border:2px solid var(--line);border-radius:14px;padding:18px}

  .global-menu{display:flex;align-items:center;justify-content:space-between;background:var(--banner);border:2px solid var(--line);border-radius:12px;padding:12px 14px;flex-wrap:wrap;gap:12px}
  .global-title{display:flex;gap:10px;align-items:center;color:var(--ink);font-weight:800;font-size:clamp(18px,2.2vw,21px)}
  .global-controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap;justify-content:flex-end}
  .user-chip{display:inline-flex;align-items:center;gap:6px;padding:6px 12px;border-radius:999px;background:var(--btn);border:2px solid var(--line);color:var(--ink);font-weight:700;white-space:nowrap}
  .user-chip .user-chip-label{color:var(--muted);font-size:clamp(12px,1.5vw,13px);font-weight:600}
  .user-chip .user-chip-name{font-size:clamp(13px,1.6vw,15px)}
  .link{color:var(--ink);text-decoration:none;font-weight:700;padding:8px 12px;border-radius:10px;border:2px solid var(--line);background:var(--btn)}
  .link:hover{background:var(--btn-hover)}
  .switch{display:inline-flex;align-items:center;gap:10px;margin-left:10px}
  .toggle{width:54px;height:30px;border-radius:100px;border:2px solid var(--line);background:var(--btn);position:relative;cursor:pointer}
  .toggle:hover{background:var(--btn-hover)}
  .knob{width:22px;height:22px;border-radius:50%;background:var(--ink);position:absolute;top:50%;transform:translateY(-50%);left:4px;transition:left .2s}
  html[data-theme="light"] .knob{left:28px}

  .section-banner{display:flex;align-items:center;justify-content:space-between;gap:14px;background:var(--banner);border:2px solid var(--line);border-radius:12px;padding:14px}
  .section-title{display:flex;gap:10px;align-items:center;color:var(--ink);font-weight:800;font-size:clamp(18px,2.4vw,22px);margin:0}
  .section-subtitle{margin:0;color:var(--muted);font-size:clamp(13px,1.6vw,15px)}

  table{width:100%;border-collapse:separate;border-spacing:0}
  th,td{padding:10px;border-bottom:1px solid var(--line);text-align:left}
  th{color:var(--ink)}
  tr:hover{background:var(--card-hover)}
  .actions{display:flex;gap:10px;flex-wrap:wrap}
  .btn{appearance:none;border:2px solid var(--line);background:var(--btn);color:var(--text);padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer;min-height:44px}
  .btn:hover{background:var(--btn-hover)}
  .detail{background:var(--detail);border:2px solid var(--line);border-radius:12px;padding:14px}
  .crumbs{display:flex;align-items:center;gap:8px;color:var(--muted);font-size:clamp(13px,1.6vw,15px);margin-bottom:12px}
  .crumbs strong{color:var(--ink)}
  .crumbs button{background:none;border:none;color:var(--ink);font-weight:700;cursor:pointer;padding:0;font-size:inherit}
  .crumbs button:hover{text-decoration:underline}
</style>
</head>
<body>
  <main class="frame">
    <div id="globalMenu"></div>
    <section class="inner">
      <header class="section-banner">
        <h1 class="section-title"><svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l9 6-3.4 10.5H6.4L3 8l9-6z"/></svg> Mail Integration (Outlook)</h1>
        <p class="section-subtitle">Manage synced data and review connection health.</p>
      </header>

      <div class="actions">
        <button class="btn" id="reset">Reset Test Data</button>
      </div>

      <div class="detail" id="listPanel">
        <h3 style="margin:0 0 8px 0;color:var(--ink)">Inbox (test data)</h3>
        <div style="overflow:auto">
          <table id="tbl">
            <thead><tr><th>From</th><th>Subject</th><th>Status</th><th>Received</th><th></th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="detail" id="detailPanel" hidden>
        <div class="crumbs">
          <button type="button" id="backToList">Inbox</button>
          <span>/</span>
          <strong id="detailSubject">Details</strong>
        </div>
        <h3 id="detailHeading" style="margin:0 0 8px 0;color:var(--ink)">Select an email</h3>
        <p id="detailMeta">Choose a message from the inbox to review its contents.</p>
        <p id="detailBody"></p>
      </div>
    </section>
  </main>

<script>
  const DB_KEY='faux-emails', AUTH_KEY='faux-auth';
  function svgPentagon(){ return '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l9 6-3.4 10.5H6.4L3 8l9-6z"/></svg>'; }
  function escapeHtml(str=''){
    const map = {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'};
    return String(str).replace(/[&<>"']/g, ch => map[ch]);
  }
  function isAuthed(){ return !!localStorage.getItem(AUTH_KEY); }
  function getCurrentUser(){ return localStorage.getItem(AUTH_KEY) || ''; }
  function globalMenuHtml({authed=false, user=''}={}){
    const links = [
      `<a class="link" href="index.html">Activity</a>`,
      `<a class="link" href="ai-review.html">AI review</a>`,
      `<a class="link" href="admin.html">Admin</a>`
    ];
    if(authed){
      links.push(`<button class="link" type="button" id="logoutBtn">Logout</button>`);
    }
    const userBadge = authed && user
      ? `<div class="user-chip"><span class="user-chip-label">Signed in as</span><span class="user-chip-name">${escapeHtml(user)}</span></div>`
      : '';
    return `
      <div class="global-menu">
        <div class="global-title">${svgPentagon()} Operations Console</div>
        <div class="global-controls">
          ${userBadge}
          ${links.join('')}
          <div class="switch"><span id="themeLabel">${document.documentElement.getAttribute('data-theme')==='light'?'Light':'Dark'}</span>
            <button class="toggle" id="themeToggle"><span class="knob"></span></button>
          </div>
        </div>
      </div>`;
  }
  function attachGlobalMenuHandlers(){
    const label = document.getElementById('themeLabel');
    if(label){
      label.textContent = document.documentElement.getAttribute('data-theme')==='light' ? 'Light' : 'Dark';
    }
    const toggle = document.getElementById('themeToggle');
    if(toggle){
      toggle.addEventListener('click', () => {
        const current = document.documentElement.getAttribute('data-theme') || 'dark';
        setTheme(current === 'dark' ? 'light' : 'dark');
      });
    }
    const logout = document.getElementById('logoutBtn');
    if(logout){
      logout.addEventListener('click', () => {
        localStorage.removeItem(AUTH_KEY);
        window.location.href = 'index.html';
      });
    }
  }

  function seedDB(){
    if(localStorage.getItem(DB_KEY)) return;
    const now=Date.now();
    const emails=[
      {id:'e1', from:'billing@tenant.io', subject:'Payment overdue: INV-1043', body:'Please process the pending invoice within 3 days to avoid late fees.', status:'urgent', received: now-3600*1000*6, aiCategory:'red', aiSynopsis:'Manual review required to confirm payment details before automation can resume.'},
      {id:'e2', from:'noreply@mailer.ai', subject:'Draft reply prepared', body:'AI drafted a response to tenant question about parking. Review and approve.', status:'draft', received: now-3600*1000*12, aiCategory:'green', aiSynopsis:'Automated draft is ready — only a quick approval is needed.'},
      {id:'e3', from:'support@locks.example', subject:'Smartlock offline – needs context', body:'Device reported intermittent connectivity. Do you want AI to attempt a reset?', status:'needs_context', received: now-3600*1000*22, aiCategory:'blue', aiSynopsis:'Additional environment context requested before continuing with automation.'},
      {id:'e4', from:'updates@crm.example', subject:'Profile note: tenant has a dog', body:'FYI: Add pet note to the profile. No action required.', status:'info', received: now-3600*1000*30, aiSynopsis:'Informational update only — automation metadata pending.'},
      {id:'e5', from:'system@ops.example', subject:'Unhandled case detected', body:'AI could not determine a safe action. Manual review required.', status:'manual', received: now-3600*1000*40, aiCategory:'red', aiSynopsis:'AI fell back to manual handling due to conflicting signals.'}
    ];
    localStorage.setItem(DB_KEY, JSON.stringify(emails));
  }
  function fmt(ts){return new Date(ts).toLocaleString()}
  function ensureAuth(){ if(!localStorage.getItem(AUTH_KEY)){ window.location.href='index.html'; } }
  function setTheme(theme){
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('notif-theme', theme);
    const label = document.getElementById('themeLabel');
    if(label){
      label.textContent = theme==='light' ? 'Light' : 'Dark';
    }
  }
  (function initTheme(){
    const stored = localStorage.getItem('notif-theme');
    if(stored){ setTheme(stored); } else {
      const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
      setTheme(prefersLight ? 'light' : 'dark');
    }
  })();
  ensureAuth(); seedDB();

  const globalMenuHost = document.getElementById('globalMenu');
  if(globalMenuHost){
    globalMenuHost.innerHTML = globalMenuHtml({authed:isAuthed(), user:getCurrentUser()});
    attachGlobalMenuHandlers();
  }

  const tbody = document.querySelector('#tbl tbody');
  const listPanel = document.getElementById('listPanel');
  const detailPanel = document.getElementById('detailPanel');
  const detailSubject = document.getElementById('detailSubject');
  const detailHeading = document.getElementById('detailHeading');
  const detailMeta = document.getElementById('detailMeta');
  const detailBody = document.getElementById('detailBody');
  const backToList = document.getElementById('backToList');

  function showList(){
    listPanel.hidden = false;
    detailPanel.hidden = true;
  }
  function showDetail(email){
    detailSubject.textContent = email.subject;
    detailHeading.textContent = email.subject;
    detailMeta.innerHTML = `<strong>From:</strong> ${email.from} • <strong>Received:</strong> ${fmt(email.received)} • <strong>Status:</strong> ${email.status}`;
    detailBody.textContent = email.body;
    listPanel.hidden = true;
    detailPanel.hidden = false;
  }

  backToList.addEventListener('click', showList);

  function render(){
    const emails = JSON.parse(localStorage.getItem(DB_KEY)||'[]');
    tbody.innerHTML = emails.map(e => `
      <tr>
        <td>${e.from}</td>
        <td>${e.subject}</td>
        <td>${e.status}</td>
        <td>${fmt(e.received)}</td>
        <td><button class="btn" data-id="${e.id}">View</button></td>
      </tr>`).join('');
    tbody.querySelectorAll('button[data-id]').forEach(b => b.onclick = () => viewEmail(b.getAttribute('data-id')));
  }
  function viewEmail(id){
    const emails = JSON.parse(localStorage.getItem(DB_KEY)||'[]');
    const e = emails.find(x=>x.id===id); if(!e) return;
    showDetail(e);
  }

  document.getElementById('reset').onclick = ()=>{ localStorage.removeItem(DB_KEY); seedDB(); render(); showList(); };
  render();
  showList();
</script>
</body>
</html>
