<!doctype html>
<html lang="en" data-theme="dark">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Activity Feed</title>
<style>
  :root { --radius:14px; --gap:12px; --focus:#7fc4ff; }
  :root, html[data-theme="dark"] {
    --bg:#0a0f16; --panel:#0d1421; --ink:#ffffff; --text:#e7edf4; --muted:#c4d0dd;
    --line:#2c3a4f; --card:#111a2a; --card-hover:#162236; --banner:#0c1322;
    --detail:#0f1829; --btn:#122033; --btn-hover:#16273e; --accent-muted:#a6b8cf;
    --red:#ff5e5e; --green:#39e384; --blue:#6aaeff; --amber:#ffb357; --crimson:#ff7a66;
    --shadow:0 6px 28px rgba(0,0,0,.35);
  }
  html[data-theme="light"] {
    --bg:#f6f8fb; --panel:#ffffff; --ink:#0a0f16; --text:#111827; --muted:#4b5563;
    --line:#d3d9e3; --card:#ffffff; --card-hover:#f4f7fb; --banner:#f0f5fb;
    --detail:#f9fbff; --btn:#eef3fb; --btn-hover:#e3ebf8; --accent-muted:#6b7e95;
    --red:#c81e1e; --green:#059669; --blue:#2563eb; --amber:#b45309; --crimson:#b91c1c;
    --shadow:0 3px 16px rgba(2,6,23,.1); --focus:#2563eb;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);
    font: clamp(15px,1.6vw,17px)/1.5 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;
    display:grid;place-items:center;padding:clamp(16px,3vw,28px);transition:background .2s,color .2s}
  .frame{width:min(1100px,98vw);background:var(--panel);border:2px solid var(--line);
    border-radius:18px;padding:clamp(12px,2.2vw,18px);box-shadow:var(--shadow)}
  .inner{display:grid;grid-template-columns:1fr;gap:clamp(12px,2vw,18px);background:var(--panel);
    border:2px solid var(--line);border-radius:14px;padding:clamp(14px,2.2vw,20px)}
  @media (min-width:900px){ .inner{grid-template-columns:1fr 1.1fr;align-items:start} }

  /* Banner with nav + theme */
  .banner{grid-column:1/-1;display:flex;align-items:center;justify-content:space-between;
    padding:clamp(10px,1.8vw,14px) clamp(12px,2.2vw,16px);background:var(--banner);
    border:2px solid var(--line);border-radius:12px}
  .title{display:flex;align-items:center;gap:12px;font-weight:800;letter-spacing:.2px;
    font-size:clamp(18px,2.4vw,22px);color:var(--ink)}
  .nav{display:flex;gap:10px;align-items:center}
  .link{color:var(--ink);text-decoration:none;font-weight:700;padding:8px 12px;border-radius:10px;border:2px solid var(--line);background:var(--btn)}
  .link:hover{background:var(--btn-hover)}
  .switch{display:inline-flex;align-items:center;gap:10px;margin-left:10px}
  .toggle{width:54px;height:30px;border-radius:100px;border:2px solid var(--line);background:var(--btn);position:relative;cursor:pointer}
  .toggle:hover{background:var(--btn-hover)}
  .knob{width:22px;height:22px;border-radius:50%;background:var(--ink);position:absolute;top:50%;transform:translateY(-50%);left:4px;transition:left .2s}
  html[data-theme="light"] .knob{left:28px}

  /* Cards list */
  .stack{display:grid;gap:12px}
  .card{display:grid;grid-template-columns:44px 1fr 24px;gap:12px;align-items:center;
    padding:clamp(12px,2vw,16px);background:var(--card);border-radius:var(--radius);border:2px solid var(--line);
    cursor:pointer;transition:background .15s,transform .05s,border-color .2s;text-align:left; min-height:86px}
  .card:hover{background:var(--card-hover);transform:translateY(-1px)}
  .card:focus-visible{outline:3px solid var(--focus);outline-offset:2px}
  .glyph{width:42px;height:42px;display:grid;place-items:center}
  .title-text{color:var(--ink);font-weight:800;letter-spacing:.2px;font-size:clamp(15px,1.9vw,17px);margin:0 0 4px 0}
  .meta{color:var(--muted);font-size:clamp(13px,1.6vw,15px)}
  .chev{opacity:.9}
  .accent-red{border-left:10px solid var(--red)} .accent-green{border-left:10px solid var(--green)}
  .accent-blue{border-left:10px solid var(--blue)} .accent-amber{border-left:10px solid var(--amber)}
  .accent-crimson{border-left:10px solid var(--crimson)} .accent-muted{border-left:10px solid var(--accent-muted)}
  .category{background:var(--card)}

  /* Details: only one mode visible at a time */
  .detail{background:var(--detail);border:2px solid var(--line);border-radius:12px;padding:clamp(14px,2.2vw,20px);min-height:160px}
  .detail .label{color:var(--muted);font-size:clamp(13px,1.5vw,15px);margin-bottom:6px}
  .detail h2{margin:0 0 8px 0;font-size:clamp(18px,2.2vw,22px);color:var(--ink)}
  .detail p{margin:0 0 12px 0}
  .detail .actions{display:flex;gap:10px;flex-wrap:wrap}
  .btn{appearance:none;border:2px solid var(--line);background:var(--btn);color:var(--text);
    padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer;min-height:44px}
  .btn:hover{background:var(--btn-hover)}

  /* Desktop aside visible, mobile inline visible */
  .aside{display:none}
  @media (min-width:900px){ .aside{display:block} .inline-detail{display:none !important} }
  @media (max-width:899px){ .aside{display:none} .inline-detail{display:block} }

  /* Login */
  .login-wrap{display:grid;gap:16px;max-width:420px;margin:auto}
  .card-plain{background:var(--panel);border:2px solid var(--line);border-radius:12px;padding:16px}
  .input{width:100%;padding:12px 12px;border:2px solid var(--line);border-radius:10px;background:var(--card);color:var(--text)}
  .row{display:grid;gap:12px}
  .error{color:#ff7a66;font-weight:700}
  @media (min-width:560px){ .row{grid-template-columns:1fr 1fr} }
</style>
</head>
<body>
  <main class="frame" id="app"></main>

<script>
  const DB_KEY = 'faux-emails';
  const AUTH_KEY = 'faux-auth';

  function seedDB(){
    if(localStorage.getItem(DB_KEY)) return;
    const now = Date.now();
    const emails = [
      {id:'e1', from:'billing@tenant.io', subject:'Payment overdue: INV-1043', body:'Please process the pending invoice within 3 days to avoid late fees.', status:'urgent', received: now-3600*1000*6},
      {id:'e2', from:'noreply@mailer.ai', subject:'Draft reply prepared', body:'AI drafted a response to tenant question about parking. Review and approve.', status:'draft', received: now-3600*1000*12},
      {id:'e3', from:'support@locks.example', subject:'Smartlock offline – needs context', body:'Device reported intermittent connectivity. Do you want AI to attempt a reset?', status:'needs_context', received: now-3600*1000*22},
      {id:'e4', from:'updates@crm.example', subject:'Profile note: tenant has a dog', body:'FYI: Add pet note to the profile. No action required.', status:'info', received: now-3600*1000*30},
      {id:'e5', from:'system@ops.example', subject:'Unhandled case detected', body:'AI could not determine a safe action. Manual review required.', status:'manual', received: now-3600*1000*40}
    ];
    localStorage.setItem(DB_KEY, JSON.stringify(emails));
  }
  function getEmails(){ try { return JSON.parse(localStorage.getItem(DB_KEY))||[] } catch { return [] } }
  function isAuthed(){ return !!localStorage.getItem(AUTH_KEY) }
  function setTheme(theme){
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('notif-theme', theme);
    const label = document.getElementById('themeLabel'); if(label) label.textContent = theme==='light' ? 'Light' : 'Dark';
  }
  (function initTheme(){
    const stored = localStorage.getItem('notif-theme');
    if(stored){ setTheme(stored); return; }
    const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
    setTheme(prefersLight ? 'light' : 'dark');
  })();
  seedDB();

  function svgPentagon(){ return '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2l9 6-3.4 10.5H6.4L3 8l9-6z"/></svg>'; }
  function cardChevron(){ return '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 6l6 6-6 6"/></svg>'; }

  function bannerHtml(){
    return \`
      <div class="banner">
        <div class="title">\${svgPentagon()} Activity Feed</div>
        <div class="nav">
          <a class="link" href="index.html">Activity</a>
          <a class="link" href="admin.html">Admin</a>
          <div class="switch"><span id="themeLabel">\${document.documentElement.getAttribute('data-theme')==='light'?'Light':'Dark'}</span>
            <button class="toggle" id="themeToggle"><span class="knob"></span></button>
          </div>
        </div>
      </div>\`;
  }
  function attachBannerToggle(){
    const toggle = document.getElementById('themeToggle');
    if(!toggle) return;
    toggle.addEventListener('click', () => {
      const current = document.documentElement.getAttribute('data-theme') || 'dark';
      setTheme(current === 'dark' ? 'light' : 'dark');
    });
  }

  function renderLogin(){
    const el = document.getElementById('app');
    el.innerHTML = \`
      <section class="inner">
        \${bannerHtml()}
        <div class="login-wrap card-plain">
          <h2 style="margin:0 0 6px 0;color:var(--ink)">Sign in</h2>
          <p class="meta" style="margin:0 0 12px 0">Enter your credentials to continue.</p>
          <div class="row">
            <input id="user" class="input" placeholder="Username" autocomplete="username">
            <input id="pass" class="input" placeholder="Password" type="password" autocomplete="current-password">
          </div>
          <div id="err" class="error" style="display:none">Invalid credentials</div>
          <div style="display:flex;gap:10px;margin-top:12px">
            <button class="btn" id="loginBtn">Login</button>
          </div>
        </div>
      </section>\`;
    attachBannerToggle();
    document.getElementById('loginBtn').onclick = () => {
      const u = document.getElementById('user').value.trim();
      const p = document.getElementById('pass').value;
      // Faux auth: any username with password 'admin'
      if(p === 'admin' && u){
        localStorage.setItem(AUTH_KEY, u);
        renderFeed();
      } else {
        const e = document.getElementById('err'); e.style.display = 'block';
      }
    };
  }

  function renderFeed(){
    if(!isAuthed()){ renderLogin(); return; }
    const emails = getEmails();
    const map = {
      'manual': {id:'ai-cannot-help', title:'AI cannot help this issue yet', accent:'accent-red', icon:'<svg viewBox=\'0 0 24 24\' fill=\'none\' stroke-width=\'2\' class=\'icon-red\'><circle cx=\'12\' cy=\'12\' r=\'9\'/></svg>'},
      'draft': {id:'draft-ready', title:'Draft ready for approval', accent:'accent-green', icon:'<svg viewBox=\'0 0 24 24\' fill=\'none\' stroke-width=\'2\' class=\'icon-green\'><rect x=\'3\' y=\'5\' width=\'18\' height=\'14\' rx=\'2\'/><path d=\'M3 7l9 6 9-6\'/></svg>'},
      'needs_context': {id:'help-ai-solve', title:'Help AI solve this task', accent:'accent-blue', icon:'<svg viewBox=\'0 0 24 24\' fill=\'none\' stroke-width=\'2\' class=\'icon-blue\'><path d=\'M12 4v16M6 10l6-6 6 6\'/></svg>'},
      'info': {id:'general-info', title:'General information', accent:'accent-amber', icon:'<svg viewBox=\'0 0 24 24\' fill=\'none\' stroke-width=\'2\' class=\'icon-amber\'><path d=\'M12 3l8 9-8 9-8-9 8-9z\'/></svg>'},
      'urgent': {id:'urgent-payment', title:'Urgent: payment deadline', accent:'accent-crimson', icon:'<svg viewBox=\'0 0 24 24\' fill=\'none\' stroke-width=\'2\' class=\'icon-crimson\'><path d=\'M12 3l10 18H2L12 3z\'/><path d=\'M12 9v5\'/><circle cx=\'12\' cy=\'17\' r=\'1.4\'/></svg>'}
    };
    const categoryCard = \`
      <button class="card category accent-muted" data-kind="category">
        <span class="glyph">\${svgPentagon()}</span>
        <div><div class="title-text">Notifications</div>
        <div class="meta">Overview of system updates and tasks</div></div>
        <span class="chev">\${cardChevron()}</span>
      </button>\`;

    const cards = emails.map(e => {
      const m = map[e.status] || map['info'];
      return \`<div class="card-wrap">
        <button class="card \${m.accent}" data-email="\${e.id}" data-kind="\${m.id}">
          <span class="glyph">\${m.icon}</span>
          <div>
            <div class="title-text">\${m.title}</div>
            <div class="meta">\${e.subject}</div>
          </div>
          <span class="chev">\${cardChevron()}</span>
        </button>
        <div class="inline-detail" id="inline-\${e.id}" hidden></div>
      </div>\`;
    }).join('');

    document.getElementById('app').innerHTML = \`
      <section class="inner">
        \${bannerHtml()}
        <div class="stack" id="cardList">\${categoryCard}\${cards}</div>
        <aside class="detail aside" id="detailAside" aria-live="polite">
          <div class="label">Details</div>
          <h2>Select a notification</h2>
          <p>The selected item will appear here with relevant actions.</p>
          <div class="actions">
            <button class="btn" disabled>Open</button>
            <button class="btn" disabled>Assign</button>
            <button class="btn" disabled>Archive</button>
          </div>
        </aside>
      </section>\`;

    attachBannerToggle();

    // Click behavior decides SINGLE render target based on screen size
    const isDesktop = () => window.matchMedia('(min-width: 900px)').matches;

    function showDetails(email, inlineEl){
      if(!email) return;
      const content = \`
        <div class="label">Email</div>
        <h2>\${email.subject}</h2>
        <p><strong>From:</strong> \${email.from} • <strong>Received:</strong> \${new Date(email.received).toLocaleString()}</p>
        <p style="margin-top:8px">\${email.body}</p>
        <div class="actions" style="margin-top:10px">
          <button class="btn">Open</button>
          <button class="btn">Assign</button>
          <button class="btn">Archive</button>
        </div>\`;

      if(isDesktop()){
        const aside = document.getElementById('detailAside');
        aside.querySelector('h2').textContent = email.subject;
        aside.querySelector('p').innerHTML = \`<strong>From:</strong> \${email.from} • <strong>Received:</strong> \${new Date(email.received).toLocaleString()}<br>\${email.body}\`;
      } else {
        // Mobile: render ONLY inline; ensure aside stays hidden by CSS
        document.querySelectorAll('.inline-detail').forEach(d => d.hidden = true);
        inlineEl.className = 'detail inline-detail';
        inlineEl.innerHTML = content;
        inlineEl.hidden = false;
        inlineEl.scrollIntoView({behavior:'smooth', block:'nearest'});
      }
    }

    const emailsById = Object.fromEntries(emails.map(e => [e.id, e]));
    document.querySelectorAll('.card[data-email]').forEach(btn => {
      btn.addEventListener('click', () => {
        const id = btn.getAttribute('data-email');
        showDetails(emailsById[id], document.getElementById('inline-'+id));
      });
    });

    // Re-select current item on resize to switch modes gracefully
    let currentId = null;
    document.querySelectorAll('.card[data-email]').forEach(btn => {
      btn.addEventListener('click', () => currentId = btn.getAttribute('data-email'));
    });
    window.addEventListener('resize', () => {
      if(!currentId) return;
      const el = document.getElementById('inline-'+currentId);
      showDetails(emailsById[currentId], el);
    });
  }

  // Boot
  if(isAuthed()){ renderFeed(); } else { renderLogin(); }
</script>
</body>
</html>
